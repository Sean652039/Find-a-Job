<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Job Applications</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../static/css/style.css"> <!-- 引入 CSS 文件 -->
</head>
<body>
    <div class="container">
        <div class="applications-container">
            <h1>Job Applications</h1>

            <div class="search-container">
                <label for="company-select">Company Name</label>
                <select id="company-select" onchange="fetchTitles()">
                    <option value="">Select a company</option>
                    {% for company in company_list %}
                        <option value="{{ company }}">{{ company }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="search-container">
                <label for="title-select">Position Title</label>
                <select id="title-select" onchange="searchApplications()">
                    <option value="">Select a title</option>
                </select>
            </div>

            <div class="search-container" style="text-align: right; margin-bottom: 20px;">
                <button class="add-btn" onclick="showAddModal()">+ Add Application</button>
            </div>

            {% for date in date_list %}
                <div class="date-group-header" onclick="toggleGroup('{{ date }}')" data-date="{{ date }}">
                    <span>{{ date }}</span>
                    <span class="arrow">&#9654;</span>
                </div>
                <table class="applications-table" id="group-{{ date }}" style="display: none;">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Date</th>
                            <th>Company</th>
                            <th>Title</th>
                            <th>Stage</th>
                            <th>Offer</th>
                        </tr>
                    </thead>
                    <tbody id="table-body-{{ date }}"></tbody>
                    <tbody id="table-body-search-results-{{ date }}"></tbody>
                </table>
            {% endfor %}
        </div>
    </div>

    <div class="analytics-container">
        <!-- 周申请趋势图 -->
        <div class="analytics-card">
            <h2 class="analytics-title">Weekly Application Trend</h2>
            <div class="chart-container">
                <canvas id="weeklyTrendChart"></canvas>
            </div>
        </div>

        <!-- 面试漏斗图 -->
        <div class="analytics-card">
            <h2 class="analytics-title">Interview Pipeline</h2>
            <div class="chart-container">
                <canvas id="funnelChart"></canvas>
            </div>
        </div>
    </div>

    <div id="addModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <h3 style="font-size: 1.25rem; font-weight: 600; color: #111827; margin-bottom: 16px;">Add New Application</h3>
            <div class="form-group">
                <label for="add-company">Company Name</label>
                <input type="text" id="add-company" class="form-input" placeholder="Enter company name">
            </div>
            <div class="form-group">
                <label for="add-title">Position Title</label>
                <input type="text" id="add-title" class="form-input" placeholder="Enter position title">
            </div>
            <div class="form-group">
                <label for="add-date">Application Date</label>
                <input type="date" id="add-date" class="form-input">
            </div>
            <div class="modal-actions">
                <button class="modal-btn cancel-add" onclick="closeAddModal()">Cancel</button>
                <button class="modal-btn confirm-add" onclick="confirmAdd()">Add</button>
            </div>
        </div>
    </div>

    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <h3 style="font-size: 1.25rem; font-weight: 600; color: #111827; margin-bottom: 8px;">Confirm Deletion</h3>
            <p style="color: #4b5563">Are you sure you want to delete this application?</p>
            <div class="modal-actions">
                <button class="modal-btn cancel-delete" onclick="closeDeleteModal()">Cancel</button>
                <button class="modal-btn confirm-delete" onclick="confirmDelete()">Delete</button>
            </div>
        </div>
    </div>
    <!-- 传递数据到 JavaScript -->
    <script id="stages-data" type="application/json">{{ stages | tojson | safe }}</script>
    <script id="dates-data" type="application/json">{{ dates | tojson | safe }}</script>
    <script id="counts-data" type="application/json">{{ counts | tojson | safe }}</script>

    <script  type="text/javascript" src="../static/js/script.js"></script>
</body>
</html>